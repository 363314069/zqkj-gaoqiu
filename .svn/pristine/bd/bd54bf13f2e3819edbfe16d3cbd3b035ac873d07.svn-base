<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
		<meta http-equiv="Pragma" content="no-cache" />
		<meta http-equiv="Expires" content="0" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta content="telephone=no" name="format-detection">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,user-scalable=no" />
		<title>九洲高尔夫—酒店预订</title>
		<script type="text/javascript" src="./../../js/flexible.js"></script>
		<script type="text/javascript" src="./../../js/jquery.min.js"></script>
		<script type="text/javascript" src="./../../js/cookie/js.cookie.min.js" ></script>
		<script type="text/javascript" src="./../../js/common.js"></script>
		<script type="text/javascript" src="./../../layer/mobile/layer.js" ></script>
		<script type="text/javascript" src="./../../layer/laydate/laydate.js" ></script>
		<link href="./../../fonts/font-zqkj/iconfont.css" rel="stylesheet" type="text/css">
		<link href="./../../fonts/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<link href="./../../css/default.css" rel="stylesheet" type="text/css">
		<script src="http://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
		<script src="./../../js/wx_api.js?v=6"></script>
		<script type="text/javascript" src="./../../res/js/zqkj/routing.js"></script>
		<script type="text/javascript" src="./../../res/js/zqkj/jump.js"></script>
	</head>
	<style>
		html,body{color: #333;}
		/*.wrap{padding-bottom: 0.88rem; }*/
		.menu {
			display: -webkit-flex;
			display: flex;
			justify-content: space-around;
			border-bottom: 1px solid #e7e7e7;
			font-size: 0.32rem;
			line-height: 0.8rem;
			background-color: #fff;
		}
		.menu > li{
			-webkit-box-flex: 1;
			-webkit-flex: 1;
			flex: 1;
			text-align: center;
			height: 0.8rem;
			padding: 0 0.1rem;
		}
		.menu .select{
			border-bottom: 0.04rem solid #2d9de7;
			color: #2d9de7;
		}
		.list{
			height: calc(100% - 0.8rem);
			overflow-y:auto;
		}
		.list .title{
			font-size: 0.24rem;
			line-height: 0.5rem;
			border-bottom: 1px solid #e7e7e7;
			margin-bottom: 0.2rem;
		}
		.list .content{
			display: -webkit-flex;
			display: flex;
		}
		.list > li{
			padding: 0.3rem;
			overflow: hidden;
			border-radius: .3rem;
			background-color: #fff;
			margin: 0.2rem;
			font-size: 0.32rem;
			color: #333;
			text-align: left;
		}
		.list .list-head .logo{
			width: 2.2rem;
			height: 2.2rem;
			overflow: hidden;
			position: relative;
			/*background: url(images/share/bg.jpg) no-repeat center center;*/
			background-size: auto 100%;
		}
		.list .list-head .item {
			width:calc(100% - 1.6rem);
			text-align: left;
			overflow: hidden;
			line-height: .5rem;
			padding-left: 0.2rem;
		}
		
		.list .list-head .title .number{float: left;}
		.list .list-head .title .state{float: right;}
		.list .list-head .title::after{display: block; content: ''; clear: both;}
		.list .list-head .logo img{display: none;}
		.list .list-head .logo .times{position: absolute;left: 0; bottom: 0; display: none; width: 100%; height: 0.5rem; z-index: 999; font-size: 0.2rem; line-height: 0.5rem; background-color: #00ab65; color: #fff;}
		.list .list-head .item .item1{font-size: 0.32rem; /*height: 1rem;*/ margin: 0.1rem 0; box-sizing: border-box; overflow: hidden;display: -webkit-box;
-webkit-box-orient: vertical;
-webkit-line-clamp: 3;}
		.list .list-head .item .item2 span{color: #DB0415; font-size: 0.28rem;}
		.list .list-head .item .item3{font-size: 0.28rem;}
		.list .list-head .btn {margin-top: 0.3rem;}
		.list .list-head .btn .pay{background-color: #DB0415;border: 1px solid #DB0415;}
		.list .list-head .btn .cancel{border: 1px solid #666; color: #666;}
		.list .list-head .btn::after{display: block; content: ''; clear: both;}
		.list .list-head .btn .buy-prices{color: #DB0415; float: left; font-size: 0.36rem;}
		.list .list-head .btn .buy-prices .original{text-decoration: line-through; color: #999; margin-left: 0.05rem; font-size: 0.2rem; display: none;} 
		.list .list-head .btn .buy-num{float: right; font-size: 0.28rem;}
		.list .list-head .btn .buy-num span{border: 1px solid #666; width: 0.4rem; text-align: center; line-height: 0.4rem; display: inline-block;}
		.list .list-head .btn .buy-num .num{border-left: none; border-right: none; width: 0.8rem;}
		.list .list-head .describe{font-size: .2rem; text-align: left; padding: .2rem 0; color: #666;}
		.list .list-head .describe textarea{width: 100%; height: 1.2rem; text-align: left; font-size: 0.32rem;}
		.list .list-params{
			line-height: 0.5rem;
			font-size: 0.28rem;
		}
		.list .list-params span{
			float: right;
		}
		.list .list-params span::after{
			font-family: "iconfont" !important;
			font-style: normal;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			content: '\e662';
			font-size: 0.32rem;
			margin-left: 0.1rem;
			color: #999;
		}
		.list .list-params div::after {display: block; content: ''; clear: both;}
		.bottom{padding: .1rem .3rem; position: fixed; left: 0; /*bottom: 0;*/ height: 0.88rem; background-color: #fff; z-index: 999; width: 100%; font-size: 0.36rem; line-height: 0.68rem;}
		.bottom .bottom-prices{color: #DB0415; float: left;}
		.bottom .bottom-btn{color: #fff; background-color: #DB0415; float: right; padding: 0 .8rem; border-radius: .34rem;}
		
		.timeItem li{text-align: left;}
		.timeItem li .itemtop{background-color: #eee; text-align: center; font-size: 0.32rem; line-height: 0.6rem;}
		.timeItem .title{
			height: .88rem;
			position: relative;
			line-height: .88rem;
			font-size: 0.36rem;
			color: #fff;
			text-align: center;
			background-color: #2d9de7;
		}
		.timeItem .title a{
			line-height: .88rem;
			font-size: 0.32rem;
			position: absolute;
			left: 0.4rem;
			top: 0;
			color: #fff;
		}
		.timeItem li div{
			font-size: 0;
		}
		.timeItem li div a{
			display: inline-block; width: 20%;
			line-height: 0.4rem;
			text-align: center;
			padding: 0.2rem;
			box-sizing: border-box;
			font-size: 0.32rem;
			position: relative;
		}
		.timeItem li div a span{display: block;}
		/*.timeItem li div a span:last-child{display: none;}*/
		
		
		.timeItem .closetime {
			background-color:#FBFBFB;
			color: #C9C9C9;
		}
		.timeItem .closetime span:nth-child(3){
			display: none;
		}
		.icon-price::before{
			font-family: "iconfont" !important;
			font-style: normal;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			content: '\e6a0';
			font-size: 0.32rem;
		}
		.list .list-userinfo div{padding: 0.2rem 0;}
		.list .list-userinfo input{background:none;  outline:none;  border:1px solid #ccc; width: calc(100% - 2rem); height: 0.6rem; line-height: 0.6rem;}
		.list .list-userinfo .code input{width: 2rem; margin-right: .4rem; }
		.list .list-userinfo .code button{background:#fff; background:none;  outline:none;  border:1px solid #ccc; text-align: center; padding: 0 0.2rem; height: 0.6rem; line-height: 0.6rem;}
		.list .list-userinfo span{display: inline-block; width: 1.4rem; text-align: right; margin-right: .2rem;}


		.btn-li{ margin-top: 0.3rem; font-size: .28rem;}
		.btn-li div:last-child div{margin-top: 0.2rem; font-size: .28rem;}
		.btn-li .buy-reserve{color: #5fb878; float: left; font-size: 0.3rem;}
		.btn-li .buy-num{float: right; font-size: 0.28rem;}
		.btn-li .buy-num span{border: 1px solid #666; width: 0.4rem; text-align: center; line-height: 0.4rem; display: inline-block;}
		.btn-li .buy-num .num{border-left: none; border-right: none; width: 0.8rem;}

		.not-time{
			background-color:#FBFBFB;
			color: #C9C9C9
		}
		
		.timeItem li div a span:nth-child(3){
			position: absolute;
			top: 0rem;
			right: .2rem;
			background-color: #ff0000;
			color: #fff;
			border-radius: 50%;
			width: .35rem;
			/* height: .35rem; */
			line-height: .35rem;
			font-size: .20rem;
		}
		.not-icon-time-price{
			background-color:#FBFBFB;
			color: #C9C9C9
		}
		
		.list .coupon span::after{
			font-family: "iconfont" !important;
			font-style: normal;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			content: '';
			font-size: 0.32rem;
			margin-left: 0.1rem;
			color: #999;
		}
	</style>

	<body>
		<div class="wrap">
			<ul class="head">
				<li class="l"><a href="my_coupons"><i class="iconfont">&#xe663;</i></a></li>
				<li class="c">填写订单</li>
				<li class="r"></li>
			</ul>
			<ul class="list">
				<li class="list-head">
					<div class="title"><span class="state">待付款</span></div>
					<div class="content">
						<div class="logo">

						</div>
						<ul class="item">
							<li id="title" class="item1"></li>
							<li class="btn">
								<div class="buy-prices"><span id="price" class="icon-price">0</span><span class="original icon-price" id="original">0</span><!--原价--></div>
							</li>
						</ul>
					</div>
				</li>
				<li class="list-params">
					<div>选择入住日期<span id="startDate"></span></div>
				</li>
				<li class="list-params">
					<div>选择退房日期<span id="endDate"></span></div>
				</li>
				<li class="btn-li">
					<div style="overflow:hidden">
						<div class="buy-reserve">预订间数：</div>
						<div class="buy-num"><span id="buy-num-reduce">-</span><span id="buy-num" class="num" max="20" min="1">1</span><span id="buy-num-add">+</span></div>
					</div>
				</li>
				<li class="btn-li">
					<div style="overflow:hidden">
						<div class="buy-reserve">入住人信息：<!--<span id="price" class="icon-price">0</span>--></div>
					</div>
					<div id="remarks">
						<div name="remarkName"><textarea style="width: 100%; height: 2rem;" type="text" name="remark" placeholder="请输入入住人信息：姓名、电话" id="defaultName"></textarea></div>
					</div>
				</li>
				<li class="list-params coupon" id="discount">

				</li>
				<li class="list-userinfo" style="display: none">
					<div><span>姓　名：</span><input type="text" name="name" id="name"></div>
					<div><span>差　点：</span><input type="text" name="chad" id="chad"></div>
					<div><span>手　机：</span><input type="text" name="phoe" id="phoe"></div>
					<div class="code"><span>验证码：</span><input type="text" name="code" id="code"><input type="button" id="dynamic" onclick="authCode();" value="发送验证码"></div>
				</li>
			</ul>
			<div class="bottom"><span class="bottom-prices icon-price" id="puyprice">0</span><a class="bottom-btn" onclick="userMessage()">支付</a></div>
		</div>
	</body>
	<script type="text/javascript" src="../../../pay/js/common-pay.js"></script>
	<script type="text/javascript">
		var activityGuid = T.p("guid");//产品GUID
		var couponsGuid = T.p("couponsGuid");//优惠券GUID
		var roomPrice = 0;//酒店单价

		var roomTotal = 1;//总间数  默认1间
		var dateTotal = 1;//预定天数  默认1天
		var userCouponsSum = 0;//用户优惠券数量
		var couponsList = new Array();//优惠券信息

		//酒店间数减号
		$("#buy-num-reduce").click(function(){
			var numdom = $("#buy-num");
			var num = parseInt(numdom.text());
			var min = parseInt(numdom.attr('min'));
			if(num > min){
				numdom.text(num - 1);
				roomTotal--;
				countPrice();//计算总金额
			}
		});
		//酒店间数加号
		$("#buy-num-add").click(function(){
			// 先把所有的优惠checkbox 都设置为不选种
			var numdom = $("#buy-num");
			var num = parseInt(numdom.text());
			var max = parseInt(numdom.attr('max'));
			if(num < max){
				numdom.text(num + 1);
				roomTotal++;
				countPrice();//计算总金额
			}
		});


		$(function(){
			footer.hide();
			//加载用户信息
			$.ajax({
				type : "GET",
				url : T.serverepay + "/security/user/selectUserMessage",
				headers : {token:T.token},
				success : function(res) {
					if (res.code == 0) {
						var data = res.data;
						if(!isNull(data.phone)){
							$(".list-userinfo").show();
							$("#name").val();
						}
					} else {
						layer.open({
							content: res.msg
							,btn: '我知道了'
						});
					}
				}
			});

			//加载酒店信息
			$.ajax({
				type: "POST",
				url: T.serverebusiness + "/business/activity/info",
				headers: {token: T.token},
				async:false,
				data: {guid: activityGuid},
				success: function (r) {
					if (r.code == 0) {
						if(r.data.img){
							$(".logo").css("background-image","url("+T.serverurl + r.data.img.replace(/\\/g, '/')+")");
						}
						roomPrice = r.data.price;
						$("#title").text(r.data.name);
						$("#price").text(r.data.price/100);
						//$("#puyprice").text(r.data.price/100);
					}
				}
			});


			//加载起始日期控件
			laydate.render({
				elem: '#startDate'
				,theme: '#2d9de7'
				,showBottom: false
				,value: new Date()
				,min: 0 //7天前
				,done: function(value, date){
					//重新选择日期后判断入住日期是否大于离店日期
					let startDate = new Date(value.replace("-", "/").replace("-", "/"));
					let endDate = new Date($("#endDate").text().replace("-", "/").replace("-", "/"));
					if(!(startDate < endDate)){
						//大于等于，重新加载离店日期
						loadEndDate(new Date(value));
					}
					//从新计算相差天数
					dateDiff(value,$("#endDate").text());
				}
			});
			//加载离店日期控件
			loadEndDate(new Date());

			//加载用户的优惠券
			$.ajax({
				type: "POST",
				url: T.serverurl + "/business/couponsuser/usercouponsact",
				headers: {token: T.token},
				data: {"actGuid":activityGuid},
				success: function(r) {
					if(r.code == 0){
						if(isNull(r.data)){
							userCouponsSum = r.data.length;
							couponsList = r.data;
							/*$.each(r.data,function (i, obj) {
								if(obj.couponsEntity.type == 2){
									$("#discount").append('<div><input type="checkbox" useType="' + obj.couponsEntity.useType + '" ctype="' + obj.couponsEntity.type + '" class="mybox" value="'+obj.couponsEntity.faceValue+'" name="faceValue" guid="'+obj.guid+'" onclick="checkboxFaceValue($(this))">'+obj.couponsEntity.name+'<span>'+ 1 +obj.couponsEntity.unit+'</span></div>');
								} else {
									$("#discount").append('<div><input type="checkbox" useType="' + obj.couponsEntity.useType + '" class="mybox" value="'+obj.couponsEntity.faceValue+'" name="faceValue" guid="'+obj.guid+'" onclick="checkboxFaceValue($(this))">'+obj.couponsEntity.name+'<span>'+obj.couponsEntity.faceValue/100+'元</span></div>');
								}
							})*/
						}else{
							$("#discount").append('<div>优惠卷<span>无可用</span></div>');
						}
						countPrice();//计算总金额
					}
				}
			});
		});


		//计算总金额
		function countPrice(){
			//先把所有选中的优惠券取消掉，让其重新选择，选择优惠券计算总金额单独拿出去
			//$('input.mybox').prop('checked', false);
			//根据日期间隔天数和预定酒店间数进行计算总金额
			//let totalPrice = roomPrice * roomTotal * dateTotal;
			//$("#puyprice").text(totalPrice/100);

			//先获取总数量  房间数*预订天数 - 优惠券数量
			let bookingCount = roomTotal * dateTotal - userCouponsSum;

			$("#discount").empty();
			if(bookingCount > 0){
				let totalPrice = roomPrice * bookingCount;
				$("#puyprice").text(totalPrice/100);
				if(userCouponsSum > 0){
					$("#discount").append('<div>您共有'+userCouponsSum+'张优惠券：自动抵扣'+userCouponsSum+'张</div>');
				}
			}else{
				$("#puyprice").text(0);
				$("#discount").append('<div>您共有'+userCouponsSum+'张优惠券：自动抵扣'+roomTotal * dateTotal+'张</div>');
			}
		}

		//加载离店日期
		function loadEndDate(date) {
			laydate.render({
				elem: '#endDate'
				,theme: '#2d9de7'
				,showBottom: false
				,value: getDate(date,1)
				,min: 1 //7天前
				,done: function(value, date){
					//从新计算相差天数
					dateDiff($("#startDate").text(),value);
				}
			});
		}

		//获取今天,明天，后天的日期
		function getDate(dates,index){
			//dates从那天开始算
			//获取选择项的下标（今0 明1 后2）；
			//一整天换算成毫秒是86400000；
			var time = dates.getTime()+parseInt(index)*86400000;
			//将毫秒转换成日期（YYYY-MM-DD）
			var date= new Date(time).toLocaleString().replace(/\//g,'-').split(" ")[0].toString();
			return date;
		}

		//计算两个日期天数差的函数，通用
		function dateDiff(sDate1, sDate2) {  //sDate1和sDate2是yyyy-MM-dd格式
			var aDate, oDate1, oDate2, iDays;
			aDate = sDate1.split("-");
			oDate1 = new Date((aDate[1] + '-' + aDate[2] + '-' + aDate[0]).replace(/\-/g, '/'));  //转换为yyyy-MM-dd格式
			aDate = sDate2.split("-");
			oDate2 = new Date((aDate[1] + '-' + aDate[2] + '-' + aDate[0]).replace(/\-/g, '/'));
			iDays = parseInt(Math.abs(oDate1 - oDate2) / 1000 / 60 / 60 / 24); //把相差的毫秒数转换为天数
			dateTotal = iDays;
			countPrice();//重新计算总金额
		}


		//选中优惠券后进行重新计算总金额
		function checkboxFaceValue(checkbox){
			// 只有当选中的时候才会去掉其他已经勾选的checkbox，所以这里只判断选中的情况
			if (checkbox.is(":checked")) {
				checkbox.prop('checked',true);
			}else{
				checkbox.prop('checked',false);
			}
			//判断优惠券金额是否大于总金额
			let totalPrice = roomPrice * roomTotal * dateTotal;
			$("#discount").find("input:checked").each(function(i, input){
				var obj = $(input);
				var cprice = parseInt(obj.val());
				if(obj.attr('ctype') == 2){
					cprice = roomPrice;
				}
				if(totalPrice < cprice){
					checkbox.prop("checked", false);
					alert("优惠券使用总金额不能大于等于订单金额！");
					return;
				}
				totalPrice = totalPrice - cprice;//订单总金额 - 优惠券金额
			});
			$("#puyprice").text(totalPrice/100);
		}



		//付款时先进行查询信息是否完善
		function userMessage() {
			$.ajax({
				type : "GET",
				url : T.serverepay + "/security/user/selectUserMessage",
				headers : {token:T.token},
				async: false,
				success : function(res) {
					if (res.code == 0) {
						var data = res.data;
						if(!isNull(data.phone)){
							//进行完善信息并支付
							submitUserOrder();
						}else{
							//已有信息直接提交订单
							payIntroduction();
						}
					} else {
						layer.open({
							content: res.msg
							,btn: '我知道了'
						});
					}
				}
			});
		}

		//完善信息
		function submitUserOrder(){
			if(!isNull($("#code").val())){
				layer.open({
					content: '验证码不能为空'
					,skin: 'msg'
					,time: 3 //2秒后自动关闭
				});
				return false;
			}else if(!isNull($("#phoe").val())){
				layer.open({
					content: '手机号不能为空'
					,skin: 'msg'
					,time: 3 //2秒后自动关闭
				});
				return false;
			}else if(isPhoneNo($("#phoe").val()) == false){
				layer.open({
					content: '请输入正确手机号'
					,skin: 'msg'
					,time: 3 //2秒后自动关闭
				});
				return false;
			}else if(isNull($("#name").val()) == false){
				layer.open({
					content: '姓名不能为空'
					,skin: 'msg'
					,time: 3 //2秒后自动关闭
				});
				return false;
			}
			$.ajax({
				type : "POST",
				url : T.serverebusiness + "/security/wxoauth/register",
				headers : {token:T.token},
				async: false,
				data : {name:$("#name").val(),chad:$("#chad").val(),phone:$("#phoe").val(),authCode:$("#code").val()},
				success : function(r) {
					if (r.code == 0) {
						payIntroduction();
					} else {
						layer.open({
							content: r.msg
							,btn: '我知道了'
						});
					}
				}
			});
		}

		//验证码
		var authCodeValue = "";
		//电话号码验证
		function isPhoneNo(phone) {
			var pattern = /^1[34578]\d{9}$/;
			return pattern.test(phone);
		}
		//发送短信
		function authCode() {
			var phoe  = $("#phoe").val();
			if(!isNull(phoe)){
				layer.open({
					content: '手机号不能为空'
					,skin: 'msg'
					,time: 3 //2秒后自动关闭
				});
				return false;
			}else if(isPhoneNo(phoe) == false){
				layer.open({
					content: '请输入正确手机号'
					,skin: 'msg'
					,time: 3 //2秒后自动关闭
				});
				return false;
			}else {
				$.ajax({
					type : "POST",
					url : T.serverebusiness + "/security/wxoauth/authcode",
					headers : {token:T.token},
					data : {phone:phoe},
					success : function(r) {
						if (r.code == 0) {
							authCodeValue = r.msg;
							var Time = 60;
							var TimeDown = setInterval(timedown,1000);
							//倒计时
							function timedown(){
								$("#dynamic").attr("disabled", true);
								$("#dynamic").val(""+ Time + "s");
								if(Time == 0){
									$("#dynamic").val("重新获取").removeAttr("disabled");
									clearInterval(TimeDown);
								}
								Time--;
							}
						} else {
							$("#dynamic").val("重新获取").removeAttr("disabled");
							layer.open({
								content: r.msg
								,btn: '我知道了'
							});
						}
					}
				});
			}
		}

		//支付
		function payIntroduction() {
			//获取订单总金额
			let totalPrice = $("#puyprice").text()*100;
			//获取入住时间
			let startDate = $("#startDate").text();
			//获取离店时间
			let endDate = $("#endDate").text();
			/*//获取使用的优惠券
			let couponsUserGuid = new Array();
			$('input[name="faceValue"]:checked').each(function(){
				couponsUserGuid.push($(this).attr("guid"));//向数组中添加元素
			});*/
			//获取使用的优惠券
			let couponsUserGuid = new Array();
			let count = roomTotal * dateTotal;
			if(count > userCouponsSum){
				$.each(couponsList,function (i,obj) {
					couponsUserGuid.push(obj.guid);
				})
			}else{
				for(let i=0;i<count;i++){
					couponsUserGuid.push(couponsList[i].guid);
				}
			}
			if(!isNull($("#defaultName").val())){
				alert("请填入入住人信息");
			}else{
				layer.open({
					type: 2
					,content: '加载中'
					,shadeClose: false
				});
				//获取备注信息
				let remark = {}
				remark.roomCount = roomTotal;
				remark.startEndDate = startDate +" 至 "+endDate;
				remark.remark = $("#defaultName").val();
				$.ajax({
					type : "POST",
					url : T.serverepay + "/pay/order/addhotelorder",
					headers : {token:T.token},
					traditional: true,
					data : {
						activityGuid : activityGuid,//酒店产品guid
						totalPrice : totalPrice,//总金额
						couponsUserGuid : couponsUserGuid,//使用优惠券guid
						remark : JSON.stringify(remark),//备注信息
						startDate : startDate,//入住时间
						endDate : endDate,//离店时间
						roomTotal : roomTotal,//预定间数
						dateTotal : dateTotal//预定天数
					},
					success : function(res) {
						layer.closeAll();
						if (res.code == 0) {
							if(res.type && res.type == 1){
								layer.open({
									content: res.msg
									,skin: 'msg'
									,time: 3 //2秒后自动关闭
								});
								jump.to("pay_success?orderGuid="+res.data.guid);
								return;
							}
							var data = $.parseJSON(res.msg);
							if (typeof WeixinJSBridge == "undefined") {
								if (document.addEventListener) {
									document.addEventListener('WeixinJSBridgeReady',
											onBridgeReady(data), false);
								} else if (document.attachEvent) {
									document.attachEvent('WeixinJSBridgeReady',
											onBridgeReady(data));
									document.attachEvent('onWeixinJSBridgeReady',
											onBridgeReady(data));
								}
							} else {
								onBridgeReady(data);
							}
						} else if (res.code == 500) {
							alertMsg(res);
						}else{
							alert(res.msg);
						}
					}
				});
			}
		}
	</script>
</html>